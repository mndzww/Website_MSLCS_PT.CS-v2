<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Matrix Competency MSLCS Division</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: #f0f2f5;
        color: #333;
      }

      .header {
        background: linear-gradient(
          135deg,
          #c53a3d 0%,
          #dc5356 50%,
          #e85a5c 100%
        );
        padding: 30px 20px;
        text-align: center;
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 20px rgba(197, 58, 61, 0.3);
        border-radius: 0 0 20px 20px;
        margin: 20px;
      }

      .header::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
          45deg,
          rgba(255, 255, 255, 0) 40%,
          rgba(255, 255, 255, 0.15) 50%,
          rgba(255, 255, 255, 0) 60%
        );
        animation: wipe 4s ease-in-out infinite;
      }

      @keyframes wipe {
        0% {
          transform: translateX(-100%) translateY(-100%) rotate(45deg);
        }
        100% {
          transform: translateX(100%) translateY(100%) rotate(45deg);
        }
      }

      .header-content {
        position: relative;
        z-index: 2;
      }

      .company-logo {
        margin-bottom: 20px;
      }

      .logo-image {
        max-height: 80px;
        max-width: 200px;
        height: auto;
        width: auto;
        filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
      }

      .header h1 {
        color: white;
        font-size: 1.7rem;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        animation: fadeInUp 1s ease-out;
        font-weight: bold;
      }

      .header p {
        color: rgba(255, 255, 255, 0.95);
        font-size: 1rem;
        animation: fadeInUp 1s ease-out 0.2s both;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
      }

      .controls {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        margin-bottom: 20px;
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
      }

      .search-box {
        flex: 1;
        min-width: 250px;
      }

      .search-box input {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: #f8f9fa;
      }

      .search-box input:focus {
        outline: none;
        border-color: #c53a3d;
        background: white;
        box-shadow: 0 0 0 3px rgba(197, 58, 61, 0.1);
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
      }

      .btn-export {
        background: #c53a3d;
        color: white;
      }

      .btn-export:hover {
        background: #a82d30;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(197, 58, 61, 0.3);
      }

      .btn-add {
        background: #c53a3d;
        color: white;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn-add:hover {
        background: #a82d30;
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(197, 58, 61, 0.3);
      }

      .info-box {
        background: #e7f3ff;
        border-left: 4px solid #2196f3;
        padding: 15px;
        margin-bottom: 20px;
        border-radius: 0 8px 8px 0;
      }

      .info-box .icon {
        color: #2196f3;
        margin-right: 8px;
      }

      .info-text {
        color: #1976d2;
        font-size: 0.95rem;
      }

      .legend {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        margin-bottom: 20px;
        border-left: 4px solid #2196f3;
      }

      .legend h3 {
        margin-bottom: 15px;
        color: #333;
        font-size: 1.1rem;
        font-weight: 600;
      }

      .legend-items {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 0.9rem;
        font-weight: 500;
      }

      .legend-item.wajib {
        background: #dc3545;
        color: white;
      }

      .legend-item.tidak-perlu {
        background: #6c757d;
        color: white;
      }

      .legend-item.tidak-wajib {
        background: #28a745;
        color: white;
      }

      .table-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        overflow: hidden;
      }

      .table-container-preview-perpegawai {
        background: white;
        border-radius: 0px 0px 12px 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        overflow: hidden;
      }

      .table {
        width: 100%;
        border-collapse: collapse;
      }

      .table th {
        background: #4a5568;
        color: white;
        padding: 12px 10px;
        text-align: center;
        font-weight: 600;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        border: 1px solid #2d3748;
      }

      .table td {
        padding: 12px;
        border-bottom: 1px solid #e2e8f0;
        border-right: 1px solid #e2e8f0;
        transition: background 0.2s ease;
        font-size: 0.9rem;
        text-align: center;
        max-width: 300px;
        word-wrap: break-word;
      }

      .table tr:hover {
        background: #f7fafc;
      }

      .table tr:last-child td {
        border-bottom: none;
      }

      .status-badge {
        padding: 6px 12px;
        border-radius: 16px;
        font-size: 0.8rem;
        font-weight: 600;
        display: inline-block;
        text-align: center;
        min-width: 80px;
      }

      .status-wajib {
        background: #dc3545;
        color: white;
      }

      .status-tidak-perlu {
        background: #6c757d;
        color: white;
      }

      .status-tidak-wajib {
        background: #28a745;
        color: white;
      }

      .clickable-row {
        cursor: pointer;
      }

      .clickable-row:hover {
        background: #f0f8ff !important;
        transform: scale(1.01);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
      }

      .empty-state h3 {
        color: #999;
        margin-bottom: 10px;
        font-size: 1.2rem;
      }

      .empty-state p {
        margin-bottom: 20px;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
        animation: fadeIn 0.3s ease;
      }

      .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background-color: #fefefe;
        margin: auto;
        padding: 0;
        border-radius: 12px;
        width: 95%;
        max-width: 1200px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        animation: slideIn 0.3s ease;
        max-height: 90vh;
        overflow: hidden;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes slideIn {
        from {
          transform: translateY(-50px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      .modal-header {
        background: linear-gradient(135deg, #c53a3d, #dc5356);
        color: white;
        padding: 20px 25px;
        border-radius: 12px 12px 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-header h2 {
        margin: 0;
        font-size: 1.4rem;
      }

      .close {
        color: white;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        transition: opacity 0.2s;
      }

      .close:hover {
        opacity: 0.7;
      }

      .modal-body {
        padding: 20px;
        max-height: 70vh;
        overflow-y: auto;
      }

      /* Detail Container Styles */
      .detail-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .detail-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .detail-row-split {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
      }

      .detail-card {
        background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
        border: 1px solid #e9ecef;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .detail-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #c53a3d, #dc5356);
        border-radius: 12px 12px 0 0;
      }

      .detail-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        border-color: #c53a3d;
      }

      .detail-card-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid #f1f3f4;
      }

      .detail-card-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #c53a3d, #dc5356);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 12px;
        font-size: 1.2rem;
        color: white;
        box-shadow: 0 4px 8px rgba(197, 58, 61, 0.3);
      }

      .detail-card-title {
        font-size: 0.85rem;
        font-weight: 600;
        color: #495057;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin: 0;
      }

      .detail-card-content {
        font-size: 1.1rem;
        font-weight: 600;
        color: #212529;
        line-height: 1.4;
        word-break: break-word;
      }

      .detail-card-content.empty {
        color: #adb5bd;
        font-style: italic;
        font-weight: 400;
      }

      /* Status badge in detail view */
      .status-badge-detail {
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: 600;
        display: inline-block;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      }

      .status-wajib-detail {
        background: linear-gradient(135deg, #dc3545, #e55a5a);
        color: white;
      }

      .status-tidak-perlu-detail {
        background: linear-gradient(135deg, #6c757d, #8a94a3);
        color: white;
      }

      .status-tidak-wajib-detail {
        background: linear-gradient(135deg, #28a745, #34ce57);
        color: white;
      }

      /* Form Styles */
      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #333;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
        background: #f8f9fa;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #c53a3d;
        background: white;
        box-shadow: 0 0 0 3px rgba(197, 58, 61, 0.1);
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      /* Tambahkan class baru untuk form 2 kolom */
      .form-grid-2 {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-bottom: 20px;
      }

      .form-group {
        margin-bottom: 0; /* Hapus margin karena sudah diatur di grid */
      }

      .form-group-full {
        grid-column: 1 / -1; /* Untuk field yang ingin full width */
        margin-bottom: 20px;
      }

      .modal-footer {
        padding: 20px 25px;
        border-top: 1px solid #eee;
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        background: #f8f9fa;
      }

      .btn-cancel {
        background: #6c757d;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
      }

      .btn-cancel:hover {
        background: #545b62;
        transform: translateY(-1px);
      }

      .btn-save {
        background: #c53a3d;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
      }

      .btn-save:hover {
        background: #a82d30;
        transform: translateY(-1px);
      }

      /* Custom Dropdown Styles */
      .custom-dropdown {
        position: relative;
        width: 100%;
      }

      .dropdown-button {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        background: #f8f9fa;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s ease;
        font-size: 1rem;
      }

      .dropdown-button:hover,
      .dropdown-button:focus {
        border-color: #c53a3d;
        background: white;
        box-shadow: 0 0 0 3px rgba(197, 58, 61, 0.1);
        outline: none;
      }

      .dropdown-text {
        flex: 1;
        text-align: left;
        color: #333;
      }

      .dropdown-text.placeholder {
        color: #999;
      }

      .dropdown-arrow {
        color: #666;
        transition: transform 0.3s ease;
        font-size: 0.8rem;
      }

      .dropdown-button.open .dropdown-arrow {
        transform: rotate(180deg);
      }

      .dropdown-menu {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-top: none;
        border-radius: 0 0 6px 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        max-height: 400px;
        overflow-y: auto;
        display: none;
      }

      .dropdown-menu.show {
        display: block;
      }

      .dropdown-category,
      .dropdown-subcategory,
      .dropdown-subsubcategory {
        padding: 12px 15px;
        cursor: pointer;
        border-bottom: 1px solid #f0f0f0;
        transition: background 0.2s ease;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .dropdown-category {
        font-weight: 600;
        background: #f8f9fa;
        border-left: 3px solid transparent;
      }

      .dropdown-category:hover {
        background: #e9ecef;
        border-left-color: #c53a3d;
      }

      .dropdown-subcategory {
        padding-left: 30px;
        font-weight: 500;
        background: #fdfdfd;
      }

      .dropdown-subcategory:hover {
        background: #f0f8ff;
      }

      .dropdown-subsubcategory {
        padding-left: 45px;
        font-weight: 400;
        background: white;
        font-size: 0.95rem;
      }

      .dropdown-subsubcategory:hover {
        background: #f0f8ff;
        color: #c53a3d;
      }

      .category-arrow,
      .subcategory-arrow {
        color: #666;
        font-size: 0.8rem;
        transition: transform 0.3s ease;
      }

      .dropdown-subcategories,
      .dropdown-subsubcategories {
        display: none;
      }

      .dropdown-subcategories.show,
      .dropdown-subsubcategories.show {
        display: block;
      }

      .dropdown-category.expanded .category-arrow,
      .dropdown-subcategory.expanded .subcategory-arrow {
        transform: rotate(90deg);
      }

      .selectable {
        cursor: pointer;
      }

      .selectable:hover {
        background: #f0f8ff !important;
        color: #c53a3d !important;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .modal-content {
          width: 95%;
          margin: 20px auto;
          max-width: none;
        }
        
        .form-grid-2 {
          grid-template-columns: 1fr;
          gap: 15px;
        }
        
        .detail-grid {
          grid-template-columns: 1fr; /* Kembali 1 kolom di mobile */
        }

        .header h1 {
          font-size: 1.8rem;
        }

        .controls {
          flex-direction: column;
          align-items: stretch;
        }

        .search-box {
          min-width: 100%;
        }

        .legend-items {
          justify-content: center;
          gap: 10px;
        }

        .table-container {
          overflow-x: auto;
        }

        .table {
          min-width: 1000px;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .modal-content {
          width: 95%;
          margin: 20px auto;
          max-width: none;
        }

        .detail-row-split {
          grid-template-columns: 1fr;
        }

        .detail-card {
          padding: 15px;
        }

        .detail-card-icon {
          width: 35px;
          height: 35px;
          font-size: 1rem;
        }

        .dropdown-menu {
          max-height: 300px;
        }

        .dropdown-category,
        .dropdown-subcategory,
        .dropdown-subsubcategory {
          padding: 10px 12px;
          font-size: 0.9rem;
        }

        .dropdown-subcategory {
          padding-left: 25px;
        }

        .dropdown-subsubcategory {
          padding-left: 35px;
        }
      }

      @media (max-width: 480px) {
        .modal-body {
          padding: 15px;
        }

        .detail-card {
          padding: 12px;
        }

        .detail-card-header {
          margin-bottom: 10px;
        }

        .detail-card-content {
          font-size: 1rem;
        }
      }
      .btn-delete {
        background: #c53a3d;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
      }

      .btn-delete:hover {
        background: #c53a3d;
        transform: translateY(-1px);
      }

      /* Tambahkan margin-top untuk infobox pratinjau */
      .info-box:last-child {
        margin-top: 40px; /* Tambahkan jarak dari tabel */
      }

      /* Styling untuk section pratinjau per-pegawai */
      .employee-preview-section {
        margin-top: 30px;
      }

      .employee-selector {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        margin-bottom: 20px;
      }

      .employee-selector label {
        display: block;
        margin-bottom: 10px;
        font-weight: 600;
        color: #333;
        font-size: 1rem;
      }

      .employee-selector select {
        width: 100%;
        max-width: 400px;
        padding: 12px 15px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 1rem;
        background: #f8f9fa;
        transition: all 0.3s ease;
      }

      .employee-selector select:focus {
        outline: none;
        border-color: #c53a3d;
        background: white;
        box-shadow: 0 0 0 3px rgba(197, 58, 61, 0.1);
      }

      /* Table untuk preview per-pegawai */
      .employee-preview-table {
        display: none;
      }

      .employee-preview-table.show {
        display: block;
      }

      .preview-table-header {
        background: white;
        padding: 15px 20px;
        border-radius: 12px 12px 0 0;
        border-left: 4px solid #c53a3d;
        margin-bottom: 0;
      }

      .preview-table-header h3 {
        margin: 0;
        color: #333;
        font-size: 1.2rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .preview-table-header .employee-icon {
        background: linear-gradient(135deg, #c53a3d, #dc5356);
        color: white;
        width: 35px;
        height: 35px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
      }
      .btn-preview {
      background: #0081FF;
      color: white;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-preview:hover {
      background: #006EE6;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(23, 162, 184, 0.3);
    }

    /* Pagination Styles */
    .pagination-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 30px 0;
      gap: 10px;
    }

    .pagination {
      display: flex;
      list-style: none;
      padding: 0;
      margin: 0;
      gap: 8px;
    }

    .pagination li {
      display: inline-block;
    }

    .pagination a {
      display: block;
      padding: 10px 15px;
      text-decoration: none;
      color: #333;
      border: 1px solid #ddd;
      border-radius: 6px;
      background: white;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .pagination a:hover {
      background: #c53a3d;
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(197, 58, 61, 0.3);
    }

    .pagination .active a {
      background: #c53a3d;
      color: white;
      border-color: #c53a3d;
    }

    .pagination .disabled a {
      color: #999;
      cursor: not-allowed;
      background: #f8f9fa;
    }

    .pagination .disabled a:hover {
      background: #f8f9fa;
      transform: none;
      box-shadow: none;
    }

    .page-info {
      margin-left: 20px;
      color: #666;
      font-size: 0.9rem;
    }

    /* Summary Section */
    .summary-section {
      margin: 40px 0;
    }

    .summary-cards {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }

    .summary-card {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border-left: 4px solid #c53a3d;
      border-right: 4px solid #c53a3d;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .summary-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .summary-card-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .summary-card-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #c53a3d, #dc5356);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      font-size: 1.5rem;
      color: white;
    }

    .summary-card-title {
      font-size: 1rem;
      font-weight: 600;
      color: #495057;
      margin: 0;
    }

    .summary-card-value {
      font-size: 2.5rem;
      font-weight: bold;
      color: #c53a3d;
      margin-bottom: 5px;
    }

    .summary-card-subtitle {
      font-size: 0.9rem;
      color: #6c757d;
      margin: 0;
    }

    /* Chart Section */
    .chart-section {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .chart-header {
      text-align: center;
      margin-bottom: 30px;
      border-bottom: 2px solid #f1f3f4;
      padding-bottom: 20px;
    }

    .chart-title {
      font-size: 1.8rem;
      font-weight: bold;
      color: #333;
      margin: 0;
    }

    .chart-subtitle {
      font-size: 1rem;
      color: #666;
      margin: 5px 0 0 0;
    }

    .chart-container {
      position: relative;
      height: 400px;
      width: 100%;
    }

    #productivityChart {
      max-width: 100%;
      height: 100%;
    }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  </head>
  <body>
    <div class="header">
      <div class="header-content">
        <div class="company-logo">
          <img
            src="public/Logo_PTCS.png"
            alt="Company Logo"
            class="logo-image"
          />
        </div>

        <!-- Detail View Modal -->
        <div id="detailModal" class="modal">
          <div class="modal-content">
            <div class="modal-header">
              <h2>Detail Data Pegawai</h2>
              <span class="close" onclick="closeDetailModal()">&times;</span>
            </div>
            <div class="modal-body">
              <div id="detailContent">
                <!-- Detail content will be populated here -->
              </div>
            </div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn-cancel"
                onclick="closeDetailModal()"
              >
                Close
              </button>
              <button type="button" class="btn-save" onclick="editFromDetail()">
                Edit Data
              </button>
              <button
                type="button"
                class="btn-delete"
                onclick="deleteFromDetail()"
              >
                Delete Data
              </button>
            </div>
          </div>
        </div>
        <h1>
          Matrix Competency of MSLCS Division - PT. Control System Arena Para
          Nusa
        </h1>
        <p>Input your any data Matrix Competency to all team project</p>
      </div>
    </div>

    <div class="container">
    <!-- Summary Section -->
    <div class="summary-section">
      <div class="summary-cards">
        <div class="summary-card">
          <div class="summary-card-header">
            <div class="summary-card-icon">💼</div>
            <h3 class="summary-card-title">Total Person in MSLCS Division</h3>
          </div>
          <div class="summary-card-value" id="totalPersons">25</div>
          <p class="summary-card-subtitle">Active employees</p>
        </div>
        
        <div class="summary-card">
          <div class="summary-card-header">
            <div class="summary-card-icon">📊</div>
            <h3 class="summary-card-title">Total Matrix Competency Records</h3>
          </div>
          <div class="summary-card-value" id="totalRecords">0</div>
          <p class="summary-card-subtitle" id="lastUpdate">Last update: -</p>
        </div>
      </div>
    </div>

    <!-- Chart Section -->
    <div class="chart-section">
      <div class="chart-header">
        <h2 class="chart-title">📈 Productivity Matrix Competency 📈</h2>
        <p class="chart-subtitle">Number of competencies completed per employee</p>
      </div>
      <div class="chart-container">
        <canvas id="productivityChart"></canvas>
      </div>
    </div>

      <div class="controls">
        <div class="search-box">
          <input
            type="text"
            id="searchInput"
            placeholder="Cari Nama Pegawai..."
          />
        </div>
        <button class="btn btn-export" onclick="exportToExcel()">Export</button>
        <button class="btn btn-add" onclick="openAddModal()">
          <span>✚</span> Tambahkan Data
        </button>
        <button class="btn btn-preview" onclick="openEmployeePreviewModal()">
          <span>👤</span> Pratinjau per-Pegawai
        </button>
      </div>

      <div class="info-box">
        <span class="info-text">
          <span class="icon">💡</span>
          Pencet baris mana saja untuk melihat detail lengkap dokumen 📄
        </span>
      </div>

      <div class="legend">
        <h3>Status Tanda Warna:</h3>
        <div class="legend-items">
          <div class="legend-item wajib">Wajib</div>
          <div class="legend-item tidak-perlu">Tidak Perlu</div>
          <div class="legend-item tidak-wajib">Tidak Wajib</div>
        </div>
      </div>

      <div class="table-container">
        <table class="table" id="dataTable">
          <thead>
            <tr>
              <th rowspan="2">NAMA</th>
              <th rowspan="2">MATRIKS<br />KOMPETENSI</th>
              <th colspan="2">TRAINING DATE (YY-MM-DD)</th>
              <th rowspan="2">TRAINING</th>
              <th rowspan="2">SERTIFIKAT</th>
              <th rowspan="2">STATUS</th>
              <th rowspan="2">AKTUAL</th>
            </tr>
            <tr>
              <th>START</th>
              <th>FINISH</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            <tr>
              <td colspan="8" class="empty-state">
                <h3>Belum ada data</h3>
                <p>
                  Klik tombol "Tambahkan Data" untuk menambahkan data pertama
                </p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      
    <!-- Pagination -->
    <div class="pagination-container">
      <ul class="pagination" id="pagination">
        <!-- Pagination items will be generated by JavaScript -->
      </ul>
      <div class="page-info" id="pageInfo">
        <!-- Page info will be generated by JavaScript -->
      </div>
    </div>
    
    
    <!-- Employee Preview Modal -->
    <div id="employeePreviewModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Pratinjau Data per-Pegawai</h2>
          <span class="close" onclick="closeEmployeePreviewModal()">&times;</span>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="employeeSelectModal">Pilih Pegawai:</label>
            <select id="employeeSelectModal" onchange="loadEmployeeData()">
              <option value="">-- Pilih Pegawai --</option>
                  <option value="Roseno Maulana Fajar">
                    Roseno Maulana Fajar
                  </option>
                  <option value="Darma Budi">Darma Budi</option>
                  <option value="Rano Try Ramadhan">Rano Try Ramadhan</option>
                  <option value="Sihab Baeta">Sihab Baeta</option>
                  <option value="Rommy Aprilianto">Rommy Aprilianto</option>
                  <option value="Ardi Firmansyah">Ardi Firmansyah</option>
                  <option value="Sigit Purwoko">Sigit Purwoko</option>
                  <option value="Handoko Endo Prasetyo">
                    Handoko Endo Prasetyo
                  </option>
                  <option value="Roby">Roby</option>
                  <option value="Goin Firdaus">Goin Firdaus</option>
                  <option value="Puji Pramudito">Puji Pramudito</option>
                  <option value="Fachrudin Suhadirman Lutfi">
                    Fachrudin Suhadirman Lutfi
                  </option>
                  <option value="Aldo Saputra">Aldo Saputra</option>
                  <option value="Husni">Husni</option>
                  <option value="Ibrahim Newton Chandra">
                    Ibrahim Newton Chandra
                  </option>
                  <option value="Miftahulia Hasby">Miftahulia Hasby</option>
                  <option value="Egi Fahlika">Egi Fahlika</option>
                  <option value="Gani Gunawan">Gani Gunawan</option>
                  <option value="Satrio Wahyu Rachmawan">
                    Satrio Wahyu Rachmawan
                  </option>
                  <option value="M. Kamil Furqon">M. Kamil Furqon</option>
                  <option value="Afif Saiful Bakhri">Afif Saiful Bakhri</option>
                  <option value="Bagus Dwi Cahyo Nugroho">
                    Bagus Dwi Cahyo Nugroho
                  </option>
                  <option value="Achmad Jainuddin">Achmad Jainuddin</option>
                  <option value="Satrio Aziz Ahmad Rabani M.">
                    Satrio Aziz Ahmad Rabani M.
                  </option>
                  <option value="Muhammad Raffi Satrio Hernawan">
                    Muhammad Raffi Satrio Hernawan
                  </option>
            </select>
          </div>

          
          <div id="employeeDataContainer" style="display: none;">
            <div class="table-container" style="margin-top: 20px;">
              <table class="table" id="employeePreviewTable">
                <thead>
                  <tr>
                    <th rowspan="2">MATRIKS<br/> KOMPETENSI</th>
                    <th colspan="2">Training Date</th>
                    <th rowspan="2">TRAINING</th>
                    <th rowspan="2">SERTIFIKAT</th>
                    <th rowspan="2">STATUS</th>
                    <th rowspan="2">AKTUAL</th>
                  </tr>
                  <tr>
                    <th>start</th>
                    <th>Finsih</th>
                  </tr>
                </thead>
                <tbody id="employeePreviewTableBody">
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Add New Item Modal -->
    <div id="addModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Tambahkan Data Pegawai</h2>
          <span class="close" onclick="closeAddModal()">&times;</span>
        </div>
        <div class="modal-body">
          <form id="addDataForm">
            <div class="form-grid-2">
              <div class="form-group">
                <label for="nama">Nama Pegawai *</label>
                <select id="nama" name="nama" required>
                  <option value="">Pilih Nama</option>
                  <option value="Roseno Maulana Fajar">
                    Roseno Maulana Fajar
                  </option>
                  <option value="Darma Budi">Darma Budi</option>
                  <option value="Rano Try Ramadhan">Rano Try Ramadhan</option>
                  <option value="Sihab Baeta">Sihab Baeta</option>
                  <option value="Rommy Aprilianto">Rommy Aprilianto</option>
                  <option value="Ardi Firmansyah">Ardi Firmansyah</option>
                  <option value="Sigit Purwoko">Sigit Purwoko</option>
                  <option value="Handoko Endo Prasetyo">
                    Handoko Endo Prasetyo
                  </option>
                  <option value="Roby">Roby</option>
                  <option value="Goin Firdaus">Goin Firdaus</option>
                  <option value="Puji Pramudito">Puji Pramudito</option>
                  <option value="Fachrudin Suhadirman Lutfi">
                    Fachrudin Suhadirman Lutfi
                  </option>
                  <option value="Aldo Saputra">Aldo Saputra</option>
                  <option value="Husni">Husni</option>
                  <option value="Ibrahim Newton Chandra">
                    Ibrahim Newton Chandra
                  </option>
                  <option value="Miftahulia Hasby">Miftahulia Hasby</option>
                  <option value="Egi Fahlika">Egi Fahlika</option>
                  <option value="Gani Gunawan">Gani Gunawan</option>
                  <option value="Satrio Wahyu Rachmawan">
                    Satrio Wahyu Rachmawan
                  </option>
                  <option value="M. Kamil Furqon">M. Kamil Furqon</option>
                  <option value="Afif Saiful Bakhri">Afif Saiful Bakhri</option>
                  <option value="Bagus Dwi Cahyo Nugroho">
                    Bagus Dwi Cahyo Nugroho
                  </option>
                  <option value="Achmad Jainuddin">Achmad Jainuddin</option>
                  <option value="Satrio Aziz Ahmad Rabani M.">
                    Satrio Aziz Ahmad Rabani M.
                  </option>
                  <option value="Muhammad Raffi Satrio Hernawan">
                    Muhammad Raffi Satrio Hernawan
                  </option>
                </select>
              </div>

              <!-- Custom Dropdown untuk Matrix Kompetensi -->
              <div class="form-group">
                <label for="matriksKompetensi"
                  >Kategori Matriks Kompetensi *</label
                >
                <div class="custom-dropdown">
                  <div class="dropdown-button" tabindex="0" id="dropdownButton">
                    <span class="dropdown-text placeholder">Pilih Kategori</span>
                    <span class="dropdown-arrow">▼</span>
                  </div>

                  <div class="dropdown-menu" id="dropdownMenu">
                    <!-- Basic Instruments (No subcategories) -->
                    <div
                      class="dropdown-category selectable"
                      data-value="Basic Instruments"
                    >
                      <span>Basic Instruments</span>
                    </div>

                    <!-- Measurement -->
                    <div class="dropdown-category" data-category="Measurement">
                      <span>Measurement</span>
                      <span class="category-arrow">▶</span>
                    </div>
                    <div class="dropdown-subcategories">
                      <!-- Liquid Analyzer -->
                      <div
                        class="dropdown-subcategory"
                        data-subcategory="Liquid Analyzer"
                      >
                        <span>Liquid Analyzer</span>
                        <span class="subcategory-arrow">▶</span>
                      </div>
                      <div class="dropdown-subsubcategories">
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Liquid Analyzer > Operation Maintenance Liquid Analyzer"
                        >
                          Operation Maintenance Liquid Analyzer
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Liquid Analyzer > Service Liquid Analyzer"
                        >
                          Service Liquid Analyzer
                        </div>
                      </div>

                      <!-- Combustion Analyzer -->
                      <div
                        class="dropdown-subcategory"
                        data-subcategory="Combustion Analyzer"
                      >
                        <span>Combustion Analyzer</span>
                        <span class="subcategory-arrow">▶</span>
                      </div>
                      <div class="dropdown-subsubcategories">
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Combustion Analyzer > OXT4A"
                        >
                          OXT4A
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Combustion Analyzer > 6888A"
                        >
                          6888A
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Combustion Analyzer > OCS880"
                        >
                          OCS880
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Combustion Analyzer > CX1100"
                        >
                          CX1100
                        </div>
                      </div>

                      <!-- Gas Chromatograph -->
                      <div
                        class="dropdown-subcategory"
                        data-subcategory="Gas Chromatograph"
                      >
                        <span>Gas Chromatograph</span>
                        <span class="subcategory-arrow">▶</span>
                      </div>
                      <div class="dropdown-subsubcategories">
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Gas Chromatograph > Daniel 500 Series"
                        >
                          Daniel 500 Series
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Gas Chromatograph > 370XA"
                        >
                          370XA
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Gas Chromatograph > 470XA"
                        >
                          470XA
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Gas Chromatograph > Rosemount 700 Series"
                        >
                          Rosemount 700 Series
                        </div>
                      </div>

                      <!-- Process Gas -->
                      <div
                        class="dropdown-subcategory"
                        data-subcategory="Process Gas"
                      >
                        <span>Process Gas</span>
                        <span class="subcategory-arrow">▶</span>
                      </div>
                      <div class="dropdown-subsubcategories">
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Process Gas > Operation Maintenance Gas Analyzer"
                        >
                          Operation Maintenance Gas Analyzer
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Process Gas > Analyzer System"
                        >
                          Analyzer System
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Process Gas > Xstream"
                        >
                          Xstream
                        </div>
                      </div>

                      <!-- ATG -->
                      <div class="dropdown-subcategory" data-subcategory="ATG">
                        <span>ATG</span>
                        <span class="subcategory-arrow">▶</span>
                      </div>
                      <div class="dropdown-subsubcategories">
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > System Overview Tank Gauging"
                        >
                          System Overview Tank Gauging
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > Tank Master Introduction"
                        >
                          Tank Master Introduction
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > 2460 System Hub"
                        >
                          2460 System Hub
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > 2410 Tank Hub"
                        >
                          2410 Tank Hub
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > Power Budget Calculation"
                        >
                          Power Budget Calculation
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > 5900 Series Radar Level Gauge"
                        >
                          5900 Series Radar Level Gauge
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > 2230 Graphic Field Display"
                        >
                          2230 Graphic Field Display
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > 2240 Temperature Transmitter"
                        >
                          2240 Temperature Transmitter
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > 565/765/566 Temperature Sensor"
                        >
                          565/765/566 Temperature Sensor
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > 2160 FCU"
                        >
                          2160 FCU
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > Rex and Pro Device"
                        >
                          Rex and Pro Device
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > 5300 Series GWR"
                        >
                          5300 Series GWR
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > 5408 Radar Level Gauge"
                        >
                          5408 Radar Level Gauge
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > Field Communication"
                        >
                          Field Communication
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > Electrical Installation"
                        >
                          Electrical Installation
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > FF Tank Bus"
                        >
                          FF Tank Bus
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > Mechanical Installation"
                        >
                          Mechanical Installation
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > System Config WinSetup"
                        >
                          System Config WinSetup
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > Inventory Management WINOPI"
                        >
                          Inventory Management WINOPI
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > LPG/LNG Radar Tank Gauging"
                        >
                          LPG/LNG Radar Tank Gauging
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > Hand Dipping Procedure and Verification"
                        >
                          Hand Dipping Procedure and Verification
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > Wireless Overview"
                        >
                          Wireless Overview
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > AMS Snap On"
                        >
                          AMS Snap On
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > SIL and Overfill Safety"
                        >
                          SIL and Overfill Safety
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > ATG > RTG-101"
                        >
                          RTG-101
                        </div>
                      </div>

                      <!-- Flow -->
                      <div class="dropdown-subcategory" data-subcategory="Flow">
                        <span>Flow</span>
                        <span class="subcategory-arrow">▶</span>
                      </div>
                      <div class="dropdown-subsubcategories">
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Flow > Introduction to Flow"
                        >
                          Introduction to Flow
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Flow > Flow Equations"
                        >
                          Flow Equations
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Flow > Flowmeter Selection"
                        >
                          Flowmeter Selection
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Flow > DP Flowmeter"
                        >
                          DP Flowmeter
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Flow > Magnetic Flowmeter"
                        >
                          Magnetic Flowmeter
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Flow > Vortex Flowmeter"
                        >
                          Vortex Flowmeter
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Flow > Densito Meter"
                        >
                          Densito Meter
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Flow > Coriolis"
                        >
                          Coriolis
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Flow > Danload 8000"
                        >
                          Danload 8000
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Flow > Roxar"
                        >
                          Roxar
                        </div>
                      </div>

                      <!-- Non Intrusive Device -->
                      <div
                        class="dropdown-subcategory"
                        data-subcategory="Non Intrusive Device"
                      >
                        <span>Non Intrusive Device</span>
                        <span class="subcategory-arrow">▶</span>
                      </div>
                      <div class="dropdown-subsubcategories">
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Non Intrusive Device > Wireless Permasense WT &ET 210, 310, 410 Corrosion & Errosion"
                        >
                          Wireless Permasense WT &ET 210, 310, 410 Corrosion &
                          Errosion
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Non Intrusive Device > SAM-42 (Sand Acoustic Monitoring)"
                        >
                          SAM-42 (Sand Acoustic Monitoring)
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Non Intrusive Device > Wireless Acoustic Transmitter 708"
                        >
                          Wireless Acoustic Transmitter 708
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Non Intrusive Device > Flexim Clamp on Fluxus Permanent & Portable"
                        >
                          Flexim Clamp on Fluxus Permanent & Portable
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Non Intrusive Device > Rosemount X-well Technology"
                        >
                          Rosemount X-well Technology
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Non Intrusive Device > Emerson Wireless 1410S Gateway"
                        >
                          Emerson Wireless 1410S Gateway
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > Non Intrusive Device > Plantweb Insight"
                        >
                          Plantweb Insight
                        </div>
                      </div>

                      <!-- FGDS -->
                      <div class="dropdown-subcategory" data-subcategory="FGDS">
                        <span>FGDS</span>
                        <span class="subcategory-arrow">▶</span>
                      </div>
                      <div class="dropdown-subsubcategories">
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > FGDS > Rosemount 925 FGD Fixed Gas Detector"
                        >
                          Rosemount 925 FGD Fixed Gas Detector
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > FGDS > Rosemount 935 Open Path Combustible Gas Detector"
                        >
                          Rosemount 935 Open Path Combustible Gas Detector
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > FGDS > Rosemount 975MR Multi-Spectrum Infrared Flame Detector"
                        >
                          Rosemount 975MR Multi-Spectrum Infrared Flame Detector
                        </div>
                        <div
                          class="dropdown-subsubcategory"
                          data-value="Measurement > FGDS > Rosemount Incus Ultrasonic Gas Leak Detector"
                        >
                          Rosemount Incus Ultrasonic Gas Leak Detector
                        </div>
                      </div>
                    </div>

                    <!-- Soft Skill -->
                    <div class="dropdown-category" data-category="Soft Skill">
                      <span>Soft Skill</span>
                      <span class="category-arrow">▶</span>
                    </div>
                    <div class="dropdown-subcategories">
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Soft Skill > Communication & Presentation Skill"
                      >
                        <span>Communication & Presentation Skill</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Soft Skill > Problem Solving & Decision Making"
                      >
                        <span>Problem Solving & Decision Making</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Soft Skill > Conflict Management"
                      >
                        <span>Conflict Management</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Soft Skill > Leadership Skill"
                      >
                        <span>Leadership Skill</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Soft Skill > Work Ethics"
                      >
                        <span>Work Ethics</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Soft Skill > Team Work"
                      >
                        <span>Team Work</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Soft Skill > Continuous Improvement"
                      >
                        <span>Continuous Improvement</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Soft Skill > Project Management for non Project Manager"
                      >
                        <span>Project Management for non Project Manager</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Soft Skill > Training for Trainer"
                      >
                        <span>Training for Trainer</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Soft Skill > Negotiation Skills For Professionals"
                      >
                        <span>Negotiation Skills For Professionals</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Soft Skill > English Skill"
                      >
                        <span>English Skill</span>
                      </div>
                    </div>

                    <!-- Kalibrasi Sertifikasi -->
                    <div
                      class="dropdown-category"
                      data-category="Kalibrasi Sertifikasi"
                    >
                      <span>Kalibrasi Sertifikasi</span>
                      <span class="category-arrow">▶</span>
                    </div>
                    <div class="dropdown-subcategories">
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Kalibrasi Sertifikasi > (BNSP) Sertifikasi Technician"
                      >
                        <span>(BNSP) Sertifikasi Technician</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Kalibrasi Sertifikasi > (BNSP) Sertifikasi Engineer"
                      >
                        <span>(BNSP) Sertifikasi Engineer</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Kalibrasi Sertifikasi > (Kalibrasi) ISO 17025"
                      >
                        <span>(Kalibrasi)ISO 17025</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Kalibrasi Sertifikasi > BSN"
                      >
                        <span>BSN</span>
                      </div>
                    </div>

                    <!-- Engineering -->
                    <div class="dropdown-category" data-category="Engineering">
                      <span>Engineering</span>
                      <span class="category-arrow">▶</span>
                    </div>
                    <div class="dropdown-subcategories">
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Engineering > Basic/Standard Electrical Training"
                      >
                        <span>Basic/Standard Electrical Training</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Engineering > Basic/Standard Mechanical Training"
                      >
                        <span>Basic/Standard Mechanical Training</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Engineering > P&ID Reading & Interpretation"
                      >
                        <span>P&ID Reading & Interpretation</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Engineering > Instrumentation & Process Control Standard"
                      >
                        <span>Instrumentation & Process Control Standard</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Engineering > Pneumatic & Hydraulic System"
                      >
                        <span>Pneumatic & Hydraulic System</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Engineering > AutoCAD / SolidWorks / Inventor / Engineering Drawing"
                      >
                        <span
                          >AutoCAD / SolidWorks / Inventor / Engineering
                          Drawing</span
                        >
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Engineering > Data Logging & Industrial IoT / IIoT"
                      >
                        <span>Data Logging & Industrial IoT / IIoT</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Engineering > Project Management (PMBOK, PMP, atau IPMA)"
                      >
                        <span>Project Management (PMBOK, PMP, atau IPMA)</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Engineering > Sampling System Design"
                      >
                        <span>Sampling System Design</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="Engineering > Lag Time Calculation Training"
                      >
                        <span>Lag Time Calculation Training</span>
                      </div>
                    </div>

                    <!-- HSE Training -->
                    <div class="dropdown-category" data-category="HSE Training">
                      <span>HSE Training</span>
                      <span class="category-arrow">▶</span>
                    </div>
                    <div class="dropdown-subcategories">
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > TBOSIET"
                      >
                        <span>TBOSIET</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > H2S Awareness"
                      >
                        <span>H2S Awareness</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Orientasi HSE"
                      >
                        <span>Orientasi HSE</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Basic Safety"
                      >
                        <span>Basic Safety</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Program 5S"
                      >
                        <span>Program 5S</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > APD"
                      >
                        <span>APD</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > APAR"
                      >
                        <span>APAR</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Job Safety Analysis & Hazardous Identification Risk Assessment and Determining Control (JSA & HIRADC)"
                      >
                        <span
                          >Job Safety Analysis & Hazardous Identification Risk
                          Assessment and Determining Control (JSA & HIRADC)</span
                        >
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > DDT"
                      >
                        <span>DDT</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > MSDS/Limbah B3"
                      >
                        <span>MSDS/Limbah B3</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Electrical Safety & Arc Flash"
                      >
                        <span>Electrical Safety & Arc Flash</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Fire Safety & Emergency Response"
                      >
                        <span>Fire Safety & Emergency Response</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > ISO 14001:2015 Sistem Manajemen Lingkungan"
                      >
                        <span>ISO 14001:2015 Sistem Manajemen Lingkungan</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > ISO 45001:2018 Sistem Manajemen K3"
                      >
                        <span>ISO 45001:2018 Sistem Manajemen K3</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > ISO 9001:2015 Awareness Sistem Manajemen Mutu"
                      >
                        <span>ISO 9001:2015 Awareness Sistem Manajemen Mutu</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > ISO 37001:2016 Awareness SM Anti Penyuapan"
                      >
                        <span>ISO 37001:2016 Awareness SM Anti Penyuapan</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Internal Auditor"
                      >
                        <span>Internal Auditor</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > AK3 Umum"
                      >
                        <span>AK3 Umum</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Incident Reporting"
                      >
                        <span>Incident Reporting</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Incident Investigation"
                      >
                        <span>Incident Investigation</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > First Aids / P3K"
                      >
                        <span>First Aids / P3K</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Petugas Kebakaran"
                      >
                        <span>Petugas Kebakaran</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Instrument and Calibration Inspector"
                      >
                        <span>Instrument and Calibration Inspector</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Confined Space Entry"
                      >
                        <span>Confined Space Entry</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > ToT"
                      >
                        <span>ToT</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Teknisi K3 Listrik"
                      >
                        <span>Teknisi K3 Listrik</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > P2K3"
                      >
                        <span>P2K3</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Safety for Managerial Level"
                      >
                        <span>Safety for Managerial Level</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Working at High"
                      >
                        <span>Working at High</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > Industrial Hygiene"
                      >
                        <span>Industrial Hygiene</span>
                      </div>
                      <div
                        class="dropdown-subcategory selectable"
                        data-value="HSE Training > K3 Migas"
                      >
                        <span>K3 Migas</span>
                      </div>
                    </div>
                  </div>
                </div>
                <input
                  type="hidden"
                  id="matriksKompetensiValue"
                  name="matriksKompetensi"
                  required
                />
              </div>

              <div class="form-grid-2">
                <div class="form-group">
                  <label for="startDate">Training Start Date</label>
                  <input type="date" id="startDate" name="startDate" />
                </div>
                <div class="form-group">
                  <label for="finishDate">Training Finish Date</label>
                  <input type="date" id="finishDate" name="finishDate" />
                </div>
              </div>

              <div class="form-grid-2">
                <div class="form-group">
                  <label for="training">Training *</label>
                  <select id="training" name="training" required>
                    <option value="">Pilih Jenis Training</option>
                    <option value="Internal">Internal</option>
                    <option value="External">External</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="topicTraining">Topic Training * </label>
                  <input
                    type="text"
                    id="topicTraining"
                    name="topicTraining"
                    placeholder="Masukkan topik/judul training"
                  />
                </div>
              </div>  

              <div class="form-grid-2">
                <div class="form-group">
                  <label for="sertifikat">Sertifikat *</label>
                  <select id="sertifikat" name="sertifikat">
                    <option value="Ada">Ada</option>
                    <option value="Tidak Ada">Tidak Ada</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="remark">Remark *</label>
                  <input
                    type="text"
                    id="remark"
                    name="remark"
                    placeholder="Catatan atau keterangan tambahan"
                  />
                </div>
              </div>

              <!-- Baris 4: Sertifikat | Remark -->
              <div class="form-grid-2">
                <div class="form-group">
                  <label for="status">Status *</label>
                  <select id="status" name="status" required>
                    <option value="">Pilih Status</option>
                    <option value="wajib">Wajib</option>
                    <option value="tidak-perlu">Tidak Perlu</option>
                    <option value="tidak-wajib">Tidak Wajib</option>
                  </select>
                </div>

                <div class="form-group">
                  <label for="actual">Aktual *</label>
                  <select id="actual" name="actual">
                    <option value="Done">Done</option>
                    <option value="Not Yet">Not Yet</option>
                  </select>
                </div>
                <p>(*) Wajib diisi</p>
              </form>
              </div>
            </div>

          <div class="modal-footer">
            <button type="button" class="btn-cancel" onclick="closeAddModal()">
              Cancel
            </button>
            <button type="button" class="btn-save" onclick="saveData()">
              Save Data
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script>
      // Data storage
      let trainingData = [];
      let currentEditIndex = -1;
      let selectedCompetencyValue = "";

      // Pagination variables
      let currentPage = 1;
      const itemsPerPage = 5;
      let totalPages = 1;
      let currentFilteredData = [];

      // Custom Dropdown Logic
      const dropdownButton = document.getElementById("dropdownButton");
      const dropdownMenu = document.getElementById("dropdownMenu");
      const dropdownText = dropdownButton.querySelector(".dropdown-text");
      const hiddenInput = document.getElementById("matriksKompetensiValue");

      // Toggle dropdown
      dropdownButton.addEventListener("click", function () {
        const isOpen = dropdownMenu.classList.contains("show");
        if (isOpen) {
          closeDropdown();
        } else {
          openDropdown();
        }
      });

      // Close dropdown when clicking outside
      document.addEventListener("click", function (e) {
        if (
          !dropdownButton.contains(e.target) &&
          !dropdownMenu.contains(e.target)
        ) {
          closeDropdown();
        }
      });

      function openDropdown() {
        dropdownMenu.classList.add("show");
        dropdownButton.classList.add("open");
      }

      function closeDropdown() {
        dropdownMenu.classList.remove("show");
        dropdownButton.classList.remove("open");

        // Close all expanded categories and subcategories
        document.querySelectorAll(".dropdown-category").forEach((cat) => {
          cat.classList.remove("expanded");
        });
        document.querySelectorAll(".dropdown-subcategory").forEach((sub) => {
          sub.classList.remove("expanded");
        });
        document.querySelectorAll(".dropdown-subcategories").forEach((sub) => {
          sub.classList.remove("show");
        });
        document
          .querySelectorAll(".dropdown-subsubcategories")
          .forEach((subsub) => {
            subsub.classList.remove("show");
          });
      }

      // Handle category clicks
      dropdownMenu.addEventListener("click", function (e) {
        e.stopPropagation();

        const category = e.target.closest(".dropdown-category");
        const subcategory = e.target.closest(".dropdown-subcategory");
        const subsubcategory = e.target.closest(".dropdown-subsubcategory");

        if (subsubcategory) {
          // Handle subsubcategory selection
          const value = subsubcategory.getAttribute("data-value");
          selectOption(value);
        } else if (
          subcategory &&
          subcategory.classList.contains("selectable")
        ) {
          // Handle selectable subcategory
          const value = subcategory.getAttribute("data-value");
          selectOption(value);
        } else if (category && category.classList.contains("selectable")) {
          // Handle selectable category (like Basic Instruments)
          const value = category.getAttribute("data-value");
          selectOption(value);
        } else if (subcategory) {
          // Handle subcategory expansion
          const subSubCategories = subcategory.nextElementSibling;
          const isExpanded = subcategory.classList.contains("expanded");

          // Close all other subcategories in the same category
          const parentCategory = subcategory.closest(".dropdown-subcategories");
          parentCategory
            .querySelectorAll(".dropdown-subcategory")
            .forEach((sub) => {
              if (sub !== subcategory) {
                sub.classList.remove("expanded");
                const subSub = sub.nextElementSibling;
                if (
                  subSub &&
                  subSub.classList.contains("dropdown-subsubcategories")
                ) {
                  subSub.classList.remove("show");
                }
              }
            });

          if (isExpanded) {
            subcategory.classList.remove("expanded");
            if (subSubCategories) subSubCategories.classList.remove("show");
          } else {
            subcategory.classList.add("expanded");
            if (subSubCategories) subSubCategories.classList.add("show");
          }
        } else if (category) {
          // Handle category expansion
          const subcategories = category.nextElementSibling;
          const isExpanded = category.classList.contains("expanded");

          // Close all other categories
          document.querySelectorAll(".dropdown-category").forEach((cat) => {
            if (cat !== category) {
              cat.classList.remove("expanded");
              const subs = cat.nextElementSibling;
              if (subs && subs.classList.contains("dropdown-subcategories")) {
                subs.classList.remove("show");
                // Also close all subcategories within
                subs
                  .querySelectorAll(".dropdown-subcategory")
                  .forEach((sub) => {
                    sub.classList.remove("expanded");
                    const subSub = sub.nextElementSibling;
                    if (
                      subSub &&
                      subSub.classList.contains("dropdown-subsubcategories")
                    ) {
                      subSub.classList.remove("show");
                    }
                  });
              }
            }
          });

          if (isExpanded) {
            category.classList.remove("expanded");
            if (subcategories) {
              subcategories.classList.remove("show");
              // Close all subcategories
              subcategories
                .querySelectorAll(".dropdown-subcategory")
                .forEach((sub) => {
                  sub.classList.remove("expanded");
                  const subSub = sub.nextElementSibling;
                  if (
                    subSub &&
                    subSub.classList.contains("dropdown-subsubcategories")
                  ) {
                    subSub.classList.remove("show");
                  }
                });
            }
          } else {
            category.classList.add("expanded");
            if (subcategories) subcategories.classList.add("show");
          }
        }
      });

      function selectOption(value) {
        selectedCompetencyValue = value;
        hiddenInput.value = value;
        dropdownText.textContent = value;
        dropdownText.classList.remove("placeholder");
        closeDropdown();
      }

      // Search functionality
      document.getElementById("searchInput").addEventListener("input", function (e) {
      const searchTerm = e.target.value.toLowerCase();
      const filteredData = trainingData.filter((item) =>
        item.nama.toLowerCase().includes(searchTerm)
      );
      setupPagination(filteredData);
    });
      // Render table with data
      function renderTable(data = trainingData) {
        setupPagination(data);
      }

      function getStatusText(status) {
        switch (status) {
          case "wajib":
            return "Wajib";
          case "tidak-perlu":
            return "Tidak Perlu";
          case "tidak-wajib":
            return "Tidak Wajib";
          default:
            return status;
        }
      }

      // Modal functions
      function openAddModal() {
        document.getElementById("addModal").classList.add("show");
        document.body.style.overflow = "hidden";
        currentEditIndex = -1;
        resetForm();
        document.querySelector(".modal-header h2").textContent =
          "Edit Data Pegawai";
      }

      function closeAddModal() {
        document.getElementById("addModal").classList.remove("show");
        document.body.style.overflow = "auto";
        resetForm();
      }

      function resetForm() {
        document.getElementById("addDataForm").reset();

        // Reset custom dropdown
        dropdownText.textContent = "Pilih Kategori";
        dropdownText.classList.add("placeholder");
        hiddenInput.value = "";
        selectedCompetencyValue = "";
        closeDropdown();
      }

      // Save data function
      function saveData() {
        const form = document.getElementById("addDataForm");
        const formData = new FormData(form);

        const nama = formData.get("nama");
        const matriksKompetensi = hiddenInput.value;
        const training = formData.get("training");
        const status = formData.get("status");

        if (!nama || !matriksKompetensi || !training || !status) {
          alert("Mohon isi semua field yang wajib (bertanda *)");
          return;
        }

        const newData = {
          nama: nama,
          matriksKompetensi: matriksKompetensi,
          startDate: formData.get("startDate") || "",
          finishDate: formData.get("finishDate") || "",
          training: training,
          topicTraining: formData.get("topicTraining") || "",
          sertifikat: formData.get("sertifikat") || "Ada",
          remark: formData.get("remark") || "",
          status: status,
          actual: formData.get("actual") || "Done",
        };

        if (currentEditIndex >= 0) {
          trainingData[currentEditIndex] = newData;
          alert("Data berhasil diupdate!");
        } else {
          trainingData.push(newData);
          alert("Data berhasil ditambahkan!");
        }

        renderTable();
        closeAddModal();
        // Refresh employee preview jika ada yang terpilih
        updateEmployeePreview();
        updateSummary();
      }

      // View details functionality
      function viewDetails(nama, index) {
        const item = trainingData[index];
        showDetailModal(item, index);
      }

      // Show detail modal
      function showDetailModal(item, index) {
        const detailContent = document.getElementById("detailContent");
        detailContent.innerHTML = `
          <div class="detail-container">
            <div class="detail-grid">
              <div class="detail-card name-card">
                <div class="detail-card-header">
                  <div class="detail-card-icon">👤</div>
                  <h3 class="detail-card-title">Nama Pegawai</h3>
                </div>
                <div class="detail-card-content">${item.nama}</div>
              </div>

              <div class="detail-card competency-card">
                <div class="detail-card-header">
                  <div class="detail-card-icon">🎯</div>
                  <h3 class="detail-card-title">Matrix Competency</h3>
                </div>
                <div class="detail-card-content" style="word-break: break-word;">${
                  item.matriksKompetensi
                }</div>
              </div>

              <div class="detail-card">
                <div class="detail-card-header">
                  <div class="detail-card-icon">📚</div>
                  <h3 class="detail-card-title">Category Training</h3>
                </div>
                <div class="detail-card-content">${item.training}</div>
              </div>

              <div class="detail-card">
                <div class="detail-card-header">
                  <div class="detail-card-icon">📖</div>
                  <h3 class="detail-card-title">Topic Training</h3>
                </div>
                <div class="detail-card-content ${
                  !item.topicTraining ? "empty" : ""
                }">${item.topicTraining || "Tidak diisi"}</div>
              </div>

              <div class="detail-card date-card">
                <div class="detail-card-header">
                  <div class="detail-card-icon">📅</div>
                  <h3 class="detail-card-title">Training Start Date</h3>
                </div>
                <div class="detail-card-content ${
                  !item.startDate ? "empty" : ""
                }">${item.startDate || "Tidak diisi"}</div>
              </div>

              <div class="detail-card date-card">
                <div class="detail-card-header">
                  <div class="detail-card-icon">🏁</div>
                  <h3 class="detail-card-title">Training Finish Date</h3>
                </div>
                <div class="detail-card-content ${
                  !item.finishDate ? "empty" : ""
                }">${item.finishDate || "Tidak diisi"}</div>
              </div>

              <div class="detail-card">
                <div class="detail-card-header">
                  <div class="detail-card-icon">📜</div>
                  <h3 class="detail-card-title">Sertifikat</h3>
                </div>
                <div class="detail-card-content">${item.sertifikat}</div>
              </div>

              <div class="detail-card status-card">
                <div class="detail-card-header">
                  <div class="detail-card-icon">🏷️</div>
                  <h3 class="detail-card-title">Status</h3>
                </div>
                <div class="detail-card-content">
                  <span class="status-badge-detail status-${
                    item.status
                  }-detail">${getStatusText(item.status)}</span>
                </div>
              </div>

              <div class="detail-card">
                <div class="detail-card-header">
                  <div class="detail-card-icon">✅</div>
                  <h3 class="detail-card-title">Aktual</h3>
                </div>
                <div class="detail-card-content">
                  <span style="padding: 8px 16px; border-radius: 12px; font-weight: 600; font-size: 0.95rem; ${
                    item.actual === "Done"
                      ? "background: #d4edda; color: #155724; border: 1px solid #c3e6cb;"
                      : "background: #f8d7da; color: #721c24; border: 1px solid #f1aeb5;"
                  }">${item.actual}</span>
                </div>
              </div>

              <div class="detail-card">
                <div class="detail-card-header">
                  <div class="detail-card-icon">💬</div>
                  <h3 class="detail-card-title">Remark</h3>
                </div>
                <div class="detail-card-content ${
                  !item.remark ? "empty" : ""
                }">${item.remark || "Tidak ada catatan"}</div>
              </div>
            </div>
          </div>
        `;

        currentEditIndex = index;
        document.getElementById("detailModal").classList.add("show");
        document.body.style.overflow = "hidden";
      }

      // Close detail modal
      function closeDetailModal() {
        document.getElementById("detailModal").classList.remove("show");
        document.body.style.overflow = "auto";
      }

      // Edit from detail modal
      function editFromDetail() {
        closeDetailModal();
        editData(currentEditIndex);
      }

      // Edit data function
      function editData(index) {
        const item = trainingData[index];
        currentEditIndex = index;

        document.getElementById("nama").value = item.nama;

        // Set custom dropdown value
        selectedCompetencyValue = item.matriksKompetensi;
        hiddenInput.value = item.matriksKompetensi;
        dropdownText.textContent = item.matriksKompetensi;
        dropdownText.classList.remove("placeholder");

        document.getElementById("startDate").value = item.startDate;
        document.getElementById("finishDate").value = item.finishDate;
        document.getElementById("training").value = item.training;
        document.getElementById("topicTraining").value =
          item.topicTraining || "";
        document.getElementById("sertifikat").value = item.sertifikat;
        document.getElementById("remark").value = item.remark || "";
        document.getElementById("status").value = item.status;
        document.getElementById("actual").value = item.actual;

        document.querySelector("#addModal .modal-header h2").textContent =
          "Tambah/Edit Data Pegawai";
        document.getElementById("addModal").classList.add("show");
        document.body.style.overflow = "hidden";
      }

      // Export to Excel functionality
      function exportToExcel() {
        if (trainingData.length === 0) {
          alert("Tidak ada data untuk diekspor!");
          return;
        }

        let csvContent = "data:text/csv;charset=utf-8,";
        csvContent +=
          "Nama,Matriks Kompetensi,Training Start Date,Training Finish Date,Training,Topic Training,Sertifikat,Remark,Status,Aktual\n";

        trainingData.forEach((item) => {
          const row = [
            `"${item.nama}"`,
            `"${item.matriksKompetensi}"`,
            item.startDate || "",
            item.finishDate || "",
            item.training,
            `"${item.topicTraining || ""}"`,
            item.sertifikat,
            `"${item.remark || ""}"`,
            getStatusText(item.status),
            item.actual || "",
          ].join(",");
          csvContent += row + "\n";
        });

        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "matrix_competency_data.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        alert("Data berhasil diekspor ke CSV!");
      }

      // Close modal when clicking outside
      window.onclick = function (event) {
        const modal = document.getElementById("addModal");
        const detailModal = document.getElementById("detailModal");
        if (event.target == modal) {
          closeAddModal();
        }
        if (event.target == detailModal) {
          closeDetailModal();
        }
      };

      // Initialize table on page load
      document.addEventListener("DOMContentLoaded", function () {
        renderTable();
        updateSummary();
      });
      function deleteData(index) {
        const item = trainingData[index];

        // Konfirmasi delete
        const confirmed = confirm(
          `Apakah Anda yakin ingin menghapus data "${item.nama}" dengan kompetensi "${item.matriksKompetensi}"?`
        );

        if (confirmed) {
          // Hapus data dari array
          trainingData.splice(index, 1);

          // Render ulang table
          renderTable();

          // Tampilkan pesan sukses
          alert("Data berhasil dihapus!");

          // Update search jika ada filter aktif
          const searchTerm = document.getElementById("searchInput").value;
          if (searchTerm) {
            const filteredData = trainingData.filter((item) =>
              item.nama.toLowerCase().includes(searchTerm.toLowerCase())
            );
            renderTable(filteredData);
          }
        }
      }

      // Pagination functions
      function setupPagination(data) {
        currentFilteredData = data;
        totalPages = Math.ceil(data.length / itemsPerPage);
        currentPage = 1;
        renderPagination();
        renderCurrentPage();
        updateSummary();
      }

      function renderPagination() {
        const pagination = document.getElementById('pagination');
        const pageInfo = document.getElementById('pageInfo');
        
        // Update page info
        const startItem = (currentPage - 1) * itemsPerPage + 1;
        const endItem = Math.min(currentPage * itemsPerPage, currentFilteredData.length);
        pageInfo.textContent = `Showing ${startItem}-${endItem} of ${currentFilteredData.length} entries`;
        
        pagination.innerHTML = '';
        
        // Previous button
        const prevLi = document.createElement('li');
        prevLi.className = currentPage === 1 ? 'disabled' : '';
        prevLi.innerHTML = `<a href="#" onclick="changePage(${currentPage - 1})">‹ Previous</a>`;
        pagination.appendChild(prevLi);
        
        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
          if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
            const li = document.createElement('li');
            li.className = i === currentPage ? 'active' : '';
            li.innerHTML = `<a href="#" onclick="changePage(${i})">${i}</a>`;
            pagination.appendChild(li);
          } else if (i === currentPage - 2 || i === currentPage + 2) {
            const li = document.createElement('li');
            li.innerHTML = '<a href="#">...</a>';
            pagination.appendChild(li);
          }
        }
        
        // Next button
        const nextLi = document.createElement('li');
        nextLi.className = currentPage === totalPages ? 'disabled' : '';
        nextLi.innerHTML = `<a href="#" onclick="changePage(${currentPage + 1})">Next ›</a>`;
        pagination.appendChild(nextLi);
      }

      function changePage(page) {
        if (page < 1 || page > totalPages || page === currentPage) return;
        currentPage = page;
        renderPagination();
        renderCurrentPage();
      }

      function renderCurrentPage() {
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const pageData = currentFilteredData.slice(startIndex, endIndex);
        
        const tbody = document.getElementById("tableBody");
        
        if (pageData.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="8" class="empty-state">
                <h3>Belum ada data</h3>
                <p>Klik tombol "Tambahkan Data" untuk menambahkan data pertama</p>
              </td>
            </tr>
          `;
          return;
        }
        
        tbody.innerHTML = "";
        pageData.forEach((item) => {
          const originalIndex = trainingData.indexOf(item);
          const row = `
            <tr class="clickable-row" onclick="viewDetails('${item.nama}', ${originalIndex})">
              <td>${item.nama}</td>
              <td style="max-width: 300px; word-wrap: break-word;">${item.matriksKompetensi}</td>
              <td>${item.startDate || "-"}</td>
              <td>${item.finishDate || "-"}</td>
              <td>${item.training}</td>
              <td>${item.sertifikat}</td>
              <td><span class="status-badge status-${item.status}">${getStatusText(item.status)}</span></td>
              <td>${item.actual || "-"}</td>
            </tr>
          `;
          tbody.innerHTML += row;
        });
      }

      // 4. FUNGSI DELETE DARI DETAIL MODAL (tambahkan fungsi baru)

      function deleteFromDetail() {
        if (currentEditIndex >= 0) {
          closeDetailModal();
          deleteData(currentEditIndex);
        }
      }

      window.onclick = function (event) {
      const modal = document.getElementById("addModal");
      const detailModal = document.getElementById("detailModal");
      const employeeModal = document.getElementById("employeePreviewModal");
      
      if (event.target == modal) {
        closeAddModal();
      }
      if (event.target == detailModal) {
        closeDetailModal();
      }
      if (event.target == employeeModal) {
        closeEmployeePreviewModal();
      }
    }

      // Modal employee preview functions
      function openEmployeePreviewModal() {
        document.getElementById("employeePreviewModal").classList.add("show");
        document.body.style.overflow = "hidden";
        // Reset selection
        document.getElementById("employeeSelectModal").value = "";
        document.getElementById("employeeDataContainer").style.display = "none";
      }

      function closeEmployeePreviewModal() {
        document.getElementById("employeePreviewModal").classList.remove("show");
        document.body.style.overflow = "auto";
      }

      function loadEmployeeData() {
        const selectedEmployee = document.getElementById("employeeSelectModal").value;
        const dataContainer = document.getElementById("employeeDataContainer");
        const tableBody = document.getElementById("employeePreviewTableBody");
        
        if (!selectedEmployee) {
          dataContainer.style.display = "none";
          return;
        }
        
        const employeeData = trainingData.filter(item => item.nama === selectedEmployee);
        
        if (employeeData.length === 0) {
          tableBody.innerHTML = `
            <tr>
              <td colspan="7" class="empty-state">
                <h3>Belum ada data</h3>
                <p>Belum ada data training untuk pegawai ini</p>
              </td>
            </tr>
          `;
        } else {
          tableBody.innerHTML = "";
          employeeData.forEach((item, index) => {
            const originalIndex = trainingData.indexOf(item);
            const row = `
              <tr class="clickable-row" onclick="viewDetails('${item.nama}', ${originalIndex})">
                <td style="max-width: 300px; word-wrap: break-word;">${item.matriksKompetensi}</td>
                <td>${item.startDate || "-"}</td>
                <td>${item.finishDate || "-"}</td>
                <td>${item.training}</td>
                <td>${item.sertifikat}</td>
                <td><span class="status-badge status-${item.status}">${getStatusText(item.status)}</span></td>
                <td>${item.actual || "-"}</td>
              </tr>
            `;
            tableBody.innerHTML += row;
          });
        }
        
        dataContainer.style.display = "block";
      }

      // Summary and Chart functions
      function updateSummary() {
        const totalRecords = document.getElementById('totalRecords');
        const lastUpdate = document.getElementById('lastUpdate');
        
        totalRecords.textContent = trainingData.length;
        
        if (trainingData.length > 0) {
          const today = new Date().toISOString().split('T')[0];
          lastUpdate.textContent = `Last update: ${today}`;
        }
        
        updateChart();
      }

      function updateChart() {
        console.log('updateChart called');
        console.log('Training data length:', trainingData.length);
        
        const ctx = document.getElementById('productivityChart').getContext('2d');
        
        // Count competencies per employee
        const employeeCompetencies = {};
        trainingData.forEach(item => {
          employeeCompetencies[item.nama] = (employeeCompetencies[item.nama] || 0) + 1;
        });
        
        const labels = Object.keys(employeeCompetencies);
        const data = Object.values(employeeCompetencies);
        
        console.log('Labels:', labels);
        console.log('Data:', data);
        
        // Destroy existing chart if it exists AND is a Chart instance
        if (window.productivityChart && typeof window.productivityChart.destroy === 'function') {
          window.productivityChart.destroy();
        }
        
        // Only create chart if we have data
        if (labels.length > 0) {
          window.productivityChart = new Chart(ctx, {
            type: 'bar',
            data: {
              labels: labels,
              datasets: [{
                label: 'Number of Competencies',
                data: data,
                backgroundColor: 'rgba(0, 129, 255, 0.8)',
                borderColor: 'rgba(0, 129, 255, 1)',
                borderWidth: 1
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    stepSize: 1
                  }
                }
              }
            }
          });
        } else {
          // Clear canvas if no data
          ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
          console.log('No data available for chart');
        }
      }
      renderTable();
      closeAddModal();
      updateSummary(); // Tambahkan ini
    </script>
  </body>
</html>
